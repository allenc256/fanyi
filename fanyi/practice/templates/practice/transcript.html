{% extends "./base.html" %}

{% load static %}
{% load format_millis %}
{% load humanize %}

{% block title %}{{ transcript.title }}{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" type="text/css" href="{% static 'practice/transcript.css' %}">
{% endblock %}

{% block body %}
    <h1>{{ transcript.title }}</h1>
    <table>
        <tr>
            <td class="metadata-header">Author</td>
            <td>{{ transcript.author }}</td>
        </tr>
        <tr>
            <td class="metadata-header">URL</td>
            <td><a href="{{ transcript.url }}">{{ transcript.url }}</td>
        </tr>
        <tr>
            <td class="metadata-header">Date published</td>
            <td>{{ transcript.date_published }}</td>
        </tr>
        <tr>
            <td class="metadata-header">Last viewed</td>
            <td>{{ last_viewed | naturaltime }}</td>
        </tr>
    </table>
    <table>
        <tr>
            <th>Index</th>
            <th>Timestamp</th>
            <th>Text</th>
            <th>Notes</th>
        </tr>
        {% for entry in page_obj %}
            <tr>
                <td>{{ entry.index | add:"1" }}</td>
                <td>{{ entry.start_ms | format_millis }}</td>
                <td>
                    <div id="heading-{{ entry.index }}">
                        <button class="text_en btn-link" data-toggle="collapse" data-target="#collapse-{{ entry.index }}" aria-expanded="false" aria-controls="collapse-{{ entry.index }}">
                            {{ entry.text_en }}
                        </button>
                    </div>
                    <div id="collapse-{{ entry.index }}" class="collapse" aria-labelledby="heading-{{ entry.index }}">
                        <table>
                            {% for translation in entry.translation_set.all %}
                                <span class="text_cn">
                                    {{ translation.text_cn_traditional }}
                                </span>
                                <span class="source">
                                    ({{ translation.source | capfirst}})
                                </span>
                                <div class="text_pinyin">
                                    {{ translation.text_cn_pinyin }}
                                </div>
                            {% endfor %}
                        </table>
                    </div>
                </td>
                <td>
                    <a href="{% url 'practice:notes' entry.pk %}?next={{ request.get_full_path | urlencode }}">{{ entry.notes | default:"+"}}</a>
                </td>
            </tr>
        {% endfor %}
    </table>
    <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>
{% endblock %}
